const i=document.querySelector("#books-wrapper"),c=document.querySelector("#selected-books-wrapper"),m=document.querySelector("#book-form"),p=document.querySelector("#book-search"),d=document.querySelector("#book-modal"),f=document.querySelector("#close-modal"),h=document.querySelector("#modal-title"),y=document.querySelector("#modal-image"),_=document.querySelector("#modal-description"),b=document.querySelector("#modal-author"),k=document.querySelector("#modal-pages"),v=document.querySelector("#modal-year"),$=document.querySelector("#modal-rating"),S=document.querySelector("#modal-language"),x=document.querySelector("#modal-link");let s=[],q=[];const w=()=>{localStorage.setItem("selectedBooks",JSON.stringify(s))},P=()=>{const e=localStorage.getItem("selectedBooks");e&&(s=JSON.parse(e),g())},L=(e,r=!1)=>{const a=r?"Remove Book":"Save Book",o=r?"bg-red-500 hover:bg-red-600":"bg-blue-500 hover:bg-blue-600";return`<div class="max-w-xs bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300 p-6 cursor-pointer transform hover:-translate-y-1 hover:scale-105" data-key="${e.key}">
          <img src="${e.image_link}" alt="Book cover" class="w-full h-64 object-cover rounded-t-lg"/>
          <div class="p-4">
            <h3 class="text-xl font-semibold mb-2 text-blue-700">${e.title}</h3>
            <p class="text-gray-600 mb-2">${e.author_name.join(", ")}</p>
            ${e.number_of_pages_median?`<p class="text-gray-600">Pages: ${e.number_of_pages_median}</p>`:""}
            ${e.first_publish_year?`<p class="text-gray-600">Published: ${e.first_publish_year}</p>`:""}
            ${e.ratings_average?`<p class="text-gray-600">Rating: ${e.ratings_average}</p>`:""}
            ${e.language?`<p class="text-gray-600">Language: ${e.language.join(", ")}</p>`:""}
            <button data-bookdata="true" data-key="${e.key}" data-title="${e.title}" data-authorname="${e.author_name.join(", ")}" data-authorkey="${e.author_key.join(", ")}" data-imagelink="${e.image_link}" class="mt-4 py-2 px-4 text-white rounded-md ${o} transition-colors duration-300">${a}</button>
          </div>
        </div>`},g=()=>{c&&(c.innerHTML=s.map(e=>L(e,!0)).join(""))},M=async e=>{const r="path/to/your/fallback-image.jpg";let a=r;const o=async n=>{try{return(await fetch(`https://covers.openlibrary.org/b/isbn/${n}-M.jpg?default=false`)).ok?(a=`https://covers.openlibrary.org/b/isbn/${n}-M.jpg?default=false`,!0):(console.error(`Image not found for ISBN: ${n}`),!1)}catch(t){return console.error(`Failed to fetch image for ISBN: ${n}`,t),!1}};for(const n of e){if(a!==r)break;await o(n)}return a},N=e=>{h&&(h.textContent=e.title),y&&(y.src=e.image_link),_&&(_.textContent=e.description||"No description available."),b&&(b.textContent=`Author: ${e.author_name.join(", ")}`),k&&(k.textContent=e.number_of_pages_median?`Pages: ${e.number_of_pages_median}`:""),v&&(v.textContent=e.first_publish_year?`Published: ${e.first_publish_year}`:""),$&&($.textContent=e.ratings_average?`Rating: ${e.ratings_average}`:""),S&&(S.textContent=e.language?`Language: ${e.language.join(", ")}`:""),x&&(x.href=e.buy_link||"#"),d&&d.classList.remove("hidden")};m&&m.addEventListener("submit",async e=>{if(e.preventDefault(),p){const r=p.value;try{const o=await(await fetch(`https://openlibrary.org/search.json?lang=en&title=${encodeURIComponent(r)}`)).json(),n=await Promise.all(o.docs.map(async t=>{const u=await M(t.isbn||[]),l={key:t.key,title:t.title,author_key:t.author_key,author_name:t.author_name,image_link:u,number_of_pages_median:t.number_of_pages_median,first_publish_year:t.first_publish_year,ratings_average:t.ratings_average,language:t.language,description:t.subtitle||"",buy_link:`https://www.bookfinder.com/search/?isbn=${t.isbn?t.isbn[0]:""}&st=sr&ac=qr`};return q.push(l),l}));if(n.length===0){i&&(i.innerHTML="<p>No books found</p>");return}i&&(i.innerHTML=n.map(t=>L(t)).join(""))}catch(a){console.error(a)}}});i&&i.addEventListener("click",e=>{const r=e.target.closest("div[data-key]");if(r){const o=r.getAttribute("data-key"),n=s.find(t=>t.key===o)||q.find(t=>t.key===o);n&&N(n)}const a=e.target;if(a&&a.hasAttribute("data-bookdata")){const o=a.getAttribute("data-key"),n=s.find(t=>t.key===o);if(n)s.splice(s.indexOf(n),1);else{const t=a.getAttribute("data-title")||"",u=a.getAttribute("data-authorname")||"",l=a.getAttribute("data-authorkey")?.split(",")||[],B=a.getAttribute("data-imagelink")||"",I=parseInt(a.closest("div")?.querySelector("p:nth-child(3)")?.textContent?.replace("Pages: ","")||"")||void 0,j=parseInt(a.closest("div")?.querySelector("p:nth-child(4)")?.textContent?.replace("Published: ","")||"")||void 0,C=parseFloat(a.closest("div")?.querySelector("p:nth-child(5)")?.textContent?.replace("Rating: ","")||"")||void 0,A=a.closest("div")?.querySelector("p:nth-child(6)")?.textContent?.replace("Language: ","").split(",")||[];s.push({key:o||"",title:t,author_key:l,author_name:u.split(", "),image_link:B,number_of_pages_median:I,first_publish_year:j,ratings_average:C,language:A})}w(),g()}});c&&c.addEventListener("click",e=>{const r=e.target;if(!r.hasAttribute("data-bookdata"))return;const a=r.getAttribute("data-key"),o=s.findIndex(n=>n.key===a);o!==-1&&(s.splice(o,1),w(),g())});f&&f.addEventListener("click",()=>{d&&d.classList.add("hidden")});window.addEventListener("load",()=>{P()});
